```mermaid
flowchart LR
    %% 实车日志
    Mcap[实车 mcap 日志<br/>(环境: obstacles/lane/traffic_light 等)]

    %% logsim 核心
    Player[logsim Player<br/>读取 mcap 环境数据]
    Engine[logsim Engine<br/>仿真时钟 + 状态管理<br/>理想控制 + 车辆模型]

    %% ZMQ 总线（可选，但推荐保留，接口跟实车一致）
    ZMQ[(ZMQ 总线)]

    %% Planning 模块
    Plan[Planning 模块<br/>只跑规划算法]

    %% 结果
    Metrics[Metrics 评估<br/>碰撞/压线/舒适性等]
    Vis[CVE/可视化<br/>展示轨迹和状态]

    %% 数据流
    Mcap -->|按仿真时间读取<br/>环境数据| Player
    Player -->|环境输入| Engine

    Engine -->|当前仿真自车状态<br/>+ 环境封装成 pb| ZMQ
    ZMQ -->|环境 + 自车状态| Plan
    Plan -->|规划输出轨迹 pb| ZMQ
    ZMQ -->|轨迹| Engine

    Engine -->|基于轨迹的理想跟踪<br/>更新自车状态| Engine

    Engine --> Metrics
    Engine --> Vis

```