```mermaid
flowchart LR
    % 实车 mcap 日志
    Mcap[实车 mcap 日志<br/>(perception/localization/vehicle/state...)]

    % logsim 引擎 / Player
    Player[logsim 引擎 / Player<br/>读取 mcap<br/>控制播放时间<br/>生成环境输入和初始自车状态]

    % ZMQ 总线
    ZMQ[(ZMQ 总线<br/>(topic + protobuf 消息))]

    %% PnC 模块
    Plan[Planning 规划模块<br/>订阅环境和自车状态<br/>输出规划轨迹]
    Ctrl[Controller 控制模块<br/>订阅轨迹和自车状态<br/>输出控制命令]

    %% 车辆模型
    Model[车辆模型 Vehicle Dynamics<br/>根据控制命令更新自车状态]

    %% 结果
    Metrics[Metrics 评估<br/>碰撞 / 压线 / 舒适性]
    Vis[CVE / 可视化工具<br/>显示轨迹和障碍物]

    %% 数据流

    Mcap -->|按时间读取 Channel/Message| Player
    Player -->|环境输入 (障碍物/车道等)| ZMQ

    Model -->|仿真自车状态 /vehicle/state| ZMQ

    ZMQ -->|环境 + 自车状态| Plan
    Plan -->|规划轨迹 /planning/trajectory| ZMQ
    ZMQ -->|轨迹 + 自车状态| Ctrl
    Ctrl -->|控制命令 /control/cmd| Model

    Model --> Metrics
    ZMQ --> Vis

```